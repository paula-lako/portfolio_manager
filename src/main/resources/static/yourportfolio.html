<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Portfolio Manager - Main Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
     <!-- Add Chart.js -->
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<!-- Sidebar placeholder -->
<div id="sidebar-container"></div>

<!-- Main Content -->
<div class="content">
    <h1 class="mb-4 text-center">ðŸ’¼ Your portfolio</h1>

    <div class="card shadow-sm main-card text-center">
        <p class="lead fw-bold">Current value:</p>

        <!-- Current Value Display (JS will update this) -->
        <h3 id="currentValueDisplay" class="fw-bold text-success mb-3">PLN 0.00</h3>

        <p class="lead fw-bold">Return rate:</p>
        <h3 id="currentReturnDisplay" class="fw-bold text-success mb-3">% 12.03</h3>

        <div class="d-flex justify-content-center">
            <a href="/performance.html" class="btn btn-light btn-lg btn-dark-border">ðŸ“ˆ Refresh data</a>
        </div>
    </div>

     <!-- Historical Charts Section -->
     <div class="card shadow-sm p-4 mb-4">
        <h4 class="text-center mb-3">ðŸ“Š Historical Portfolio Value</h4>
        <canvas id="portfolioHistoryChart" height="300"></canvas>
    </div>

     <!-- Historical return rate -->
     <div class="card shadow-sm p-4 mb-4">
        <h4 class="text-center mb-3">ðŸ“Š Historical Return Rates</h4>
        <canvas id="portfolioHistoryChartReturn" height="300"></canvas>
    </div>



    <footer class="mt-5 text-center text-muted">
        &copy; 2025 Portfolio Manager App by 4 Girls Band
    </footer>
</div>

    <script>

        const userId = 1;        // Use seeded user
        const portfolioId = 1;   // Use seeded portfolio
        // Load sidebar dynamically
        fetch("sidebar.html")
            .then(res => res.text())
            .then(data => {
                document.getElementById("sidebar-container").innerHTML = data;
            })
            .catch(err => console.error("Sidebar load error:", err));
        
        // Fetch current portfolio value from backend API
        fetch('/user/${userId}/portfolio/${portfolioId}/value')
            .then(response => response.json())
            .then(data => {
                const value = data.currentValue; // backend returns { "currentValue": 12345.67 }
                document.getElementById('currentValueDisplay').innerText = `$${value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            })
            .catch(err => console.error('Error fetching current value:', err));

        // current return rate
        fetch('/user/${userId}/portfolio/${portfolioId}/return')
            .then(response => response.json())
            .then(data => {
                const value = data.currentReturn; // backend returns { "currenReturn": 12345.67 }
                document.getElementById('currentReturnDisplay').innerText = `$${value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            })
            .catch(err => console.error('Error fetching current return:', err));



        // Example portfolio history data (replace with real values)
    ///const historyLabels = ["Jan", "Feb", "Mar", "Apr", "May"];
    //const historyValues = [10000, 10500, 11000, 10200, 12000];

    fetch('/user/${userId}/portfolio/${portfolioId}/history')  // userId and portfolioId variables
    .then(response => response.json())
    .then(data => {
        const labels = data.map(entry => entry.date);   // dates from backend
        const values = data.map(entry => entry.value);  // values from backend

        const ctx = document.getElementById("portfolioHistoryChart").getContext("2d");
        new Chart(ctx, {
            type: "line",
            data: {
                labels: labels,  // use dynamic labels
                datasets: [{
                    label: "Portfolio Value ($)",
                    data: values,  // use dynamic values
                    borderColor: "rgba(75, 192, 192, 1)",
                    backgroundColor: "rgba(75, 192, 192, 0.2)",
                    borderWidth: 2,
                    fill: true,
                    tension: 0.2
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: true, position: "bottom" } },
                scales: {
                    y: { beginAtZero: false, title: { display: true, text: "Value ($)" } },
                    x: { title: { display: true, text: "Date" } }
                }
            }
        });
    })
    .catch(err => console.error('Error fetching portfolio history:', err));


    // return rate chart
        // Example portfolio history data (replace with real values)
        const historyLabels1 = ["Jan", "Feb", "Mar", "Apr", "May"];
        const historyValues1 = [0.510000, 0.56, 0.54, 0.456, 0.87];
    
        const ctx1 = document.getElementById("portfolioHistoryChartReturn").getContext("2d");
        new Chart(ctx1, {
            type: "line",
            data: {
                labels: historyLabels1,
                datasets: [{
                    label: "Portfolio Return Rate",
                    data: historyValues1,
                    borderColor: "rgba(75, 192, 192, 1)",
                    backgroundColor: "rgba(75, 192, 192, 0.2)",
                    borderWidth: 2,
                    fill: true,
                    tension: 0.2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: "bottom" }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        title: { display: true, text: "Rate" }
                    },
                    x: {
                        title: { display: true, text: "Date" }
                    }
                }
            }
        });
            
    </script>

</body>
</html>
